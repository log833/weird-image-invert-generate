<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Weird Image Invert Generate</title>
<link rel="icon" href="icon.png" type="image/png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: white;
    text-align: center;
    padding: 20px;
  }

  input, button {
    margin: 10px 0;
  }

  canvas {
    max-width: 100%;
    border: 1px solid #555;
    margin-top: 10px;
    display: none;
  }

  #loading {
    display: none;
    margin-top: 15px;
    font-size: 18px;
    opacity: 0.8;
  }

  .controls {
    display: none;
    margin-top: 15px;
  }
</style>
</head>

<body>

<h2>Weird Image Invert Generate</h2>

<input type="file" accept="image/*" id="upload">

<div id="loading">Loading...</div>

<canvas id="canvas"></canvas>

<div class="controls" id="controls">
  <div>
    Opacity:
    <input type="range" id="opacity" min="0" max="100" value="100">
  </div>
  <button id="download">Download</button>
</div>

<script>
const upload = document.getElementById("upload");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const loading = document.getElementById("loading");
const controls = document.getElementById("controls");
const opacitySlider = document.getElementById("opacity");
const downloadBtn = document.getElementById("download");

let baseImageData = null;

upload.addEventListener("change", () => {
  const file = upload.files[0];
  if (!file) return;

  loading.style.display = "block";
  canvas.style.display = "none";
  controls.style.display = "none";

  const img = new Image();
  img.onload = () => {
    canvas.width = img.width;
    canvas.height = img.height;

    ctx.drawImage(img, 0, 0);

    // Get pixels and invert colors
    baseImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = baseImageData.data;

    for (let i = 0; i < data.length; i += 4) {
      data[i]     = 255 - data[i];     // R
      data[i + 1] = 255 - data[i + 1]; // G
      data[i + 2] = 255 - data[i + 2]; // B
      data[i + 3] = 255;               // Full alpha base
    }

    drawWithOpacity();

    loading.style.display = "none";
    canvas.style.display = "block";
    controls.style.display = "block";
  };

  img.src = URL.createObjectURL(file);
});

function drawWithOpacity() {
  if (!baseImageData) return;

  // Clone image data so we don't destroy original
  const imgData = new ImageData(
    new Uint8ClampedArray(baseImageData.data),
    baseImageData.width,
    baseImageData.height
  );

  const alpha = opacitySlider.value / 100 * 255;

  for (let i = 3; i < imgData.data.length; i += 4) {
    imgData.data[i] = alpha;
  }

  ctx.putImageData(imgData, 0, 0);
}

opacitySlider.addEventListener("input", drawWithOpacity);

downloadBtn.addEventListener("click", () => {
  const link = document.createElement("a");
  link.download = "invert9_image.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
});
</script>

<h3>v1.0.2</h3>

</body>
</html>
